"use strict";(self.webpackChunkpine_docs=self.webpackChunkpine_docs||[]).push([[2699],{5890:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>d,contentTitle:()=>i,default:()=>l,frontMatter:()=>o,metadata:()=>a,toc:()=>c});var t=r(4848),s=r(8453);const o={sidebar_position:1},i="Server",a={id:"Guide - Advanced/server",title:"Server",description:"Welcome to the advanced section where you will learn the core principles of Pine and how I was able to build simple yet efficient solutions. Through out this guide, you will learn how you can implement Pine's solutions on your own.",source:"@site/docs/Guide - Advanced/server.md",sourceDirName:"Guide - Advanced",slug:"/Guide - Advanced/server",permalink:"/pine-docs/docs/Guide - Advanced/server",draft:!1,unlisted:!1,editUrl:"https://github.com/BryanMwangi/pine-docs/blob/main/docs/Guide - Advanced/server.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1},sidebar:"tutorialSidebar",previous:{title:"Guide - Advanced",permalink:"/pine-docs/docs/category/guide---advanced"},next:{title:"Routing",permalink:"/pine-docs/docs/Guide - Advanced/routing"}},d={},c=[{value:"Start a new server",id:"start-a-new-server",level:2},{value:"Start",id:"start",level:3},{value:"ServeHTTP",id:"servehttp",level:3},{value:"Use",id:"use",level:3},{value:"ServeShutDown",id:"serveshutdown",level:3}];function h(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"server",children:"Server"})}),"\n",(0,t.jsx)(n.p,{children:"Welcome to the advanced section where you will learn the core principles of Pine and how I was able to build simple yet efficient solutions. Through out this guide, you will learn how you can implement Pine's solutions on your own."}),"\n",(0,t.jsx)(n.p,{children:"Improvements and suggestions are more than welcome."}),"\n",(0,t.jsx)(n.p,{children:"Let us start with the Server struct. The core of what Pine is built on. Here is a recap of the struct and its properties."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-go",children:"type Server struct {\n  mutex sync.Mutex\n\n  //standard http server\n  server *http.Server\n\n  //here you can customize shut down events.\n  //For future releases, we will add connection pools and\n  //shutting them down will be here\n  onShutdown []func()\n\n  //logger for errors\n  errorLog *log.Logger\n\n  //configuration for the server\n  config Config\n\n  //an array of registered routes when the server starts\n  //the route stack is divided by HTTP methods and route prefixes\n  stack [][]*Route\n\n  //middleware stack\n  middleware []Middleware\n}\n"})}),"\n",(0,t.jsxs)(n.p,{children:["As you can see the Server is very simple making use of the standard ",(0,t.jsx)(n.a,{href:"https://pkg.go.dev/net/http#Server",children:"http Server"})," with an ace up its sleeves and that is the routing system."]}),"\n",(0,t.jsx)(n.h2,{id:"start-a-new-server",children:"Start a new server"}),"\n",(0,t.jsxs)(n.p,{children:["Use the ",(0,t.jsx)(n.code,{children:"New"})," function to create a new server instance. Let us break down what the new function does."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-go",children:"func New(config ...Config) *Server\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Depending on whether you pass your own config or use the ",(0,t.jsx)(n.a,{href:"/docs/Guide%20-%20Basics/pine#default-config",children:"default config"}),", the new function will create a new instance of the server."]}),"\n",(0,t.jsx)(n.p,{children:"After completion this is what is created:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-go",children:'server := &Server{\n  config:   cfg,\n  stack:    make([][]*Route, len(cfg.RequestMethods)),\n  errorLog: log.New(os.Stderr, "ERROR: ", log.LstdFlags),\n}\n'})}),"\n",(0,t.jsx)(n.p,{children:"So far you can see nothing special about the server and you can pretty much do the same on your own."}),"\n",(0,t.jsx)(n.h3,{id:"start",children:"Start"}),"\n",(0,t.jsxs)(n.p,{children:["The start method takes the port on which the server will listen to and depending on whether or not you set up TLS, this will be handled over HTTP or HTTPS. If you want to use TLS, you will need to provide a certificate and key. Remember to set up the ",(0,t.jsx)(n.a,{href:"/docs/Guide%20-%20Basics/pine#default-tls-configuration",children:"TLS config"})," before calling start."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-go",children:"func (server *Server) Start(address string) error\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Internally, once again, nothing special is going on instead we simply just create a new http server instance and call either ",(0,t.jsx)(n.code,{children:"httpServer.ListenAndServe()"})," or ",(0,t.jsx)(n.code,{children:"httpServer.ListenAndServeTLS"})," depending on whether or not you set up TLS."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-go",children:"httpServer := &http.Server{\n  Addr:         address,\n  ReadTimeout:  server.config.ReadTimeout,\n  WriteTimeout: server.config.WriteTimeout,\n  Handler:      server,\n}\n"})}),"\n",(0,t.jsx)(n.p,{children:"So far you can do this on your own without Pine and I hope you are following along."}),"\n",(0,t.jsx)(n.h3,{id:"servehttp",children:"ServeHTTP"}),"\n",(0,t.jsx)(n.p,{children:"The server struct also offers a method where http requests are then handled:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-go",children:"func (server *Server) ServeHTTP(w http.ResponseWriter, r *http.Request)\n"})}),"\n",(0,t.jsxs)(n.p,{children:["This is where the magic of the routing system happens and more on that in the next section of the ",(0,t.jsx)(n.a,{href:"./routing",children:"router"}),"."]}),"\n",(0,t.jsxs)(n.p,{children:["Within the ",(0,t.jsx)(n.code,{children:"ServeHTTP"})," method, this is where we construct the ",(0,t.jsx)(n.a,{href:"/docs/Guide%20-%20Basics/ctx",children:"Ctx"})," that is then passed to the handlers when a request is made. The newly constructed ctx is very simple and contains all the necessary fields to handle the request."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-go",children:"wrappedWriter := &responseWriterWrapper{ResponseWriter: w}\n\nctx := &Ctx{\n  Server:   server,\n  Method:   r.Method,\n  BaseURI:  r.URL.Path,\n  Request:  r,\n  Response: wrappedWriter,\n  params:   make(map[string]string),\n}\n"})}),"\n",(0,t.jsxs)(n.p,{children:["You can check out ",(0,t.jsx)(n.a,{href:"/docs/Guide%20-%20Basics/ctx",children:"Ctx"})," section for a recap on its properties. The next section will go in depth as to how the params are handled during ",(0,t.jsx)(n.a,{href:"./routing",children:"routing"}),"."]}),"\n",(0,t.jsx)(n.h3,{id:"use",children:"Use"}),"\n",(0,t.jsx)(n.p,{children:"This method is used to add middlewares to the server. Middlewares are special handlers that are executed before the handlers of a route."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-go",children:"func (server *Server) Use(middleware Middleware)\n"})}),"\n",(0,t.jsx)(n.h3,{id:"serveshutdown",children:"ServeShutDown"}),"\n",(0,t.jsx)(n.p,{children:"There is also a method provide that you can use to shut down the server as well as add some functions you wish to execute during the shutdown process. This allows for graceful shutdown of the server."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-go",children:"func (server *Server) ServeShutDown(ctx context.Context, hooks ...func()) error\n"})}),"\n",(0,t.jsx)(n.p,{children:"That's pretty much it for your server. You see, you do not need a framework to get started with building servers in Go. Of course there are a couple of improvements we could implement to improve performance and efficiency, but this is the basic building block of a framework like Pine."})]})}function l(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(h,{...e})}):h(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>i,x:()=>a});var t=r(6540);const s={},o=t.createContext(s);function i(e){const n=t.useContext(o);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),t.createElement(o.Provider,{value:n},e.children)}}}]);