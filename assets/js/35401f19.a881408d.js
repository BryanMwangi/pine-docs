"use strict";(self.webpackChunkpine_docs=self.webpackChunkpine_docs||[]).push([[8920],{4721:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>h,contentTitle:()=>i,default:()=>d,frontMatter:()=>s,metadata:()=>r,toc:()=>l});var o=n(4848),a=n(8453);const s={slug:"you-dont-need-a-framework",title:"You Do not Need a Framework",authors:"bryanmwangi",tags:["pine","helloWorld","new"]},i=void 0,r={permalink:"/blog/you-dont-need-a-framework",editUrl:"https://github.com/BryanMwangi/pine-docs/blob/main/blog/you_dont_need_a_framework.md",source:"@site/blog/you_dont_need_a_framework.md",title:"You Do not Need a Framework",description:"This probably sounds insane having spent time building Pine, however, I have to say that you may not need a framework to build a server in Go. In this blog I will outline why I built Pine and what I have learnt from it.",date:"2024-10-21T20:01:04.000Z",tags:[{inline:!1,label:"Pine",permalink:"/blog/tags/pine",description:"Posts directly related to Pine"},{inline:!1,label:"Hello World",permalink:"/blog/tags/helloWorld",description:"Hello World!"},{inline:!1,label:"New",permalink:"/blog/tags/new",description:"New feature or update"}],readingTime:8.095,hasTruncateMarker:!0,authors:[{name:"Bryan Mwangi",title:"Full Stack Developer Golang + JS",url:"https://github.com/BryanMwangi",page:{permalink:"/blog/authors/bryanmwangi"},socials:{linkedin:"https://www.linkedin.com/in/bryan-gichuru-b6b200128/",github:"https://github.com/BryanMwangi"},imageURL:"https://github.com/BryanMwangi.png",key:"bryanmwangi"}],frontMatter:{slug:"you-dont-need-a-framework",title:"You Do not Need a Framework",authors:"bryanmwangi",tags:["pine","helloWorld","new"]},unlisted:!1},h={authorsImageUrls:[void 0]},l=[{value:"Why Pine?",id:"why-pine",level:2},{value:"Enter Pine",id:"enter-pine",level:2},{value:"Clarification",id:"clarification",level:2},{value:"Let us continue",id:"let-us-continue",level:2},{value:"Routing",id:"routing",level:3},{value:"Other Challenges",id:"other-challenges",level:2},{value:"Nice to have",id:"nice-to-have",level:2},{value:"Mistakes",id:"mistakes",level:2},{value:"Benchmarks",id:"benchmarks",level:2},{value:"Conclusion",id:"conclusion",level:2}];function c(e){const t={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,a.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(t.p,{children:"This probably sounds insane having spent time building Pine, however, I have to say that you may not need a framework to build a server in Go. In this blog I will outline why I built Pine and what I have learnt from it."}),"\n",(0,o.jsx)(t.h2,{id:"why-pine",children:"Why Pine?"}),"\n",(0,o.jsx)(t.p,{children:"About 2 months ago, I and a group of other people were tasked with a small project to build a food ordering system. The challenge was to not use any framework on the backend and utilize the standard library as much as possible."}),"\n",(0,o.jsx)(t.p,{children:"This got me thinking. Is it possible to achieve the same level of performance and efficiency as working with frameworks such as Fiber, Echo or Gin? What is it that makes them boast insane numbers when it comes to performance?"}),"\n",(0,o.jsx)(t.h2,{id:"enter-pine",children:"Enter Pine"}),"\n",(0,o.jsxs)(t.p,{children:["Well Pine was born with those exact questions in mind. Build a ",(0,o.jsx)(t.a,{href:"https://pkg.go.dev/net/http",children:"net/http"})," server in Go and not use any framework but have the same level of performance and efficiency."]}),"\n",(0,o.jsxs)(t.p,{children:["I have used Fiber in the past and I loved it especially when I was transitioning from node to Go. On node, I would use the ",(0,o.jsx)(t.a,{href:"https://expressjs.com/",children:"express"})," npm package to build servers on node JS and I was a bit lazy and wanted anything that would offer the same experience as I was learning Go."]}),"\n",(0,o.jsx)(t.p,{children:"Fiber is a breeze to use and before you say anything, yes, Pine has some similarities with Fiber. This is particularly noticeable in some of the configurations used by the main Server instance as one reddit comment pointed out."}),"\n",(0,o.jsx)(t.p,{children:"The similarities end at the configurations of the main Server struct and maybe the Helmet package."}),"\n",(0,o.jsx)(t.h2,{id:"clarification",children:"Clarification"}),"\n",(0,o.jsxs)(t.p,{children:["When I made this ",(0,o.jsx)(t.a,{href:"https://www.reddit.com/r/golang/comments/1g2h7yp/pine_a_simple_express_js_or_fiber_golang/",children:"post"})," a couple of weeks ago, 2 people wanted to claim that Pine was a balant copy of Fiber with the underlying workings of ",(0,o.jsx)(t.a,{href:"https://github.com/valyala/fasthttp",children:"fasthttp"})," changed to ",(0,o.jsx)(t.a,{href:"https://pkg.go.dev/net/http",children:"net/http"}),"."]}),"\n",(0,o.jsx)(t.p,{children:"Here is the thing. Naming is hard in programming and the same can be seen here. Just because you have similar naming schemes does not mean whatever is performing the logic is the same."}),"\n",(0,o.jsx)(t.p,{children:"I would like to encourage you to carefully read the underlying code to understand how it works before making certain accusations."}),"\n",(0,o.jsx)(t.h2,{id:"let-us-continue",children:"Let us continue"}),"\n",(0,o.jsx)(t.p,{children:"With that out of the way, let us look into the challenges of making your own framework."}),"\n",(0,o.jsx)(t.h3,{id:"routing",children:"Routing"}),"\n",(0,o.jsx)(t.p,{children:"After trying to understand how open source routers work as well as other frameworks' routing system, I was able to come up with my own solution to solve routing."}),"\n",(0,o.jsxs)(t.p,{children:["The challenge of performance boils down to how fast you can route a request to its respective handlers, process the request and send back a response to the client. Whenever you as a developer are using Pine to create a router, you would use some of the inbuilt methods related to the server instance you create after calling the ",(0,o.jsx)(t.code,{children:"New"})," function. One example is the ",(0,o.jsx)(t.code,{children:"Get"})," method:"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-go",children:"func (server *Server) Get(path string, handlers ...Handler)\n"})}),"\n",(0,o.jsxs)(t.p,{children:["You can then use this method to create a route such as ",(0,o.jsx)(t.code,{children:"GET /hello"})," and pass the handlers that you want to execute when the request is made."]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-go",children:'app.Get("/hello", func(c *pine.Ctx) error {\n  return c.SendString("Hello World")\n})\n'})}),"\n",(0,o.jsx)(t.p,{children:"After creating the route, internally Pine, creates a stack of routes that it uses to efficiently match a request to its respective handlers."}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-go",children:"stack [][]*Route\n"})}),"\n",(0,o.jsxs)(t.p,{children:["We index the routes on server startup and whenever a request is made, we extract things like parameters when generating a Ctx related to the request. More on the ",(0,o.jsx)(t.a,{href:"/docs/Guide%20-%20Basics/ctx",children:"Ctx here"}),"."]}),"\n",(0,o.jsx)(t.p,{children:"Now, you do not even need to implement routing yourself as you can use other packages including ones built into the standard library for this. Examples include:"}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsx)(t.li,{children:(0,o.jsx)(t.a,{href:"https://github.com/julienschmidt/httprouter",children:"httprouter"})}),"\n",(0,o.jsx)(t.li,{children:(0,o.jsx)(t.a,{href:"https://github.com/go-chi/chi",children:"chi"})}),"\n",(0,o.jsx)(t.li,{children:(0,o.jsx)(t.a,{href:"https://github.com/gorilla/mux",children:"gorilla/mux"})}),"\n",(0,o.jsx)(t.li,{children:(0,o.jsx)(t.a,{href:"https://pkg.go.dev/net/http@master#ServeMux",children:"net/http.ServeMux"})}),"\n"]}),"\n",(0,o.jsx)(t.h2,{id:"other-challenges",children:"Other Challenges"}),"\n",(0,o.jsx)(t.p,{children:"With an efficient routing system in place, most of the remaining challenges are purely for the sake of a better developer experience."}),"\n",(0,o.jsxs)(t.p,{children:["Most frameworks use the ",(0,o.jsx)(t.a,{href:"https://en.wikipedia.org/wiki/Don%27t_repeat_yourself",children:"DRY"})," principle to reduce the amount of code you need to write. Using this philosophy, you tend to write code that allows you to focus on the core functionality of your server without having to repeat yourself."]}),"\n",(0,o.jsx)(t.p,{children:"For example, instead of re-writing code to handle writing a json response over and over again, you can build your own solution that accepts data as an interface and encodes to json and writes the response to the response body."}),"\n",(0,o.jsx)(t.p,{children:"These abstractions are what make frameworks so powerful and allow you to focus on the core functionality of your server. Not that they are miles ahead or have some secret sauce that makes them stand out, and you can build these solutions yourself."}),"\n",(0,o.jsx)(t.h2,{id:"nice-to-have",children:"Nice to have"}),"\n",(0,o.jsx)(t.p,{children:"Pine offers some neat features out of the box that you can easily implement yourself or use Pine's implementation of them."}),"\n",(0,o.jsxs)(t.p,{children:["One such feature is the ",(0,o.jsx)(t.a,{href:"/docs/Guide%20-%20Basics/cron",children:"cron"})," package. During my exercise with my colleagues, we had to have a feature that would update a database at a specific interval. I then thought to myself that we could have cron jobs that can do such tasks during the server's runtime."]}),"\n",(0,o.jsxs)(t.p,{children:["Another neat feature is the ",(0,o.jsx)(t.a,{href:"/docs/Guide%20-%20Basics/websockets#watchfile",children:"WatchFile"})," function implemented within the ",(0,o.jsx)(t.a,{href:"/docs/Guide%20-%20Basics/websockets",children:"websockets"})," package. This feature came to me after utilizing ",(0,o.jsx)(t.a,{href:"https://fly.io",children:"fly.io"})," services for some time now."]}),"\n",(0,o.jsxs)(t.p,{children:["If you have used them before, you have the ability to monitor live logs. The only challenge is you have a small window in which you can see the logs in unless you dive deeper in the ",(0,o.jsx)(t.code,{children:"search logs"})," feature. I then thought to myself, what if I wanted to see all my logs in my log file and in real time?"]}),"\n",(0,o.jsxs)(t.p,{children:["With ",(0,o.jsx)(t.code,{children:"WatchFile"}),", you can do exactly that. You first need to open a websocket connection to allow streaming of the logs in real time and more on this in the ",(0,o.jsx)(t.a,{href:"/docs/Guide%20-%20Basics/websockets",children:"websockets guide"}),"."]}),"\n",(0,o.jsx)(t.h2,{id:"mistakes",children:"Mistakes"}),"\n",(0,o.jsx)(t.p,{children:"I am aware that there may be some mistakes in the implementation of Pine and that is why I encourage anyone to not just point out the mistakes but also to suggest improvements to the code. That is the only way we can all collectively improve ourselves."}),"\n",(0,o.jsx)(t.p,{children:"This project started off as a learning exercise and as you can see from my benchmarks, Pine is able to compete with Fiber in synthetic tests."}),"\n",(0,o.jsx)(t.h2,{id:"benchmarks",children:"Benchmarks"}),"\n",(0,o.jsxs)(t.p,{children:["One comment from the post is that there was no way to perform a benchmark with Pine or at least I did not highlight how I was able test this. I used a tool called ",(0,o.jsx)(t.a,{href:"https://github.com/hatoo/oha",children:"Oha"})," to test the performance of the server."]}),"\n",(0,o.jsx)(t.p,{children:"Setting up a benchmark is simple. First open any directory you wish to use and set up a new Go project. Next import the Pine package using the following command:"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-bash",children:"go get github.com/BryanMwangi/pine\n"})}),"\n",(0,o.jsx)(t.p,{children:"In your main.go start a simple server and pass the port you wish to listen to."}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-go",children:'package main\n\nimport (\n    "log"\n\n    "github.com/BryanMwangi/pine"\n)\n\nfunc main() {\n    // Initialize a new Pine app\n    app := pine.New()\n\n    // Define a route for the GET method on the path \'/hello\'\n    app.Get("/hello", func(c *pine.Ctx) error {\n        return c.SendString("Hello World!")\n    })\n\n    // Start the server on port 3000\n    log.Fatal(app.Start(":3000"))\n}\n'})}),"\n",(0,o.jsx)(t.p,{children:"You can change the routes to your choosing or try out different tests such as JSON encoding, middlewares etc."}),"\n",(0,o.jsxs)(t.p,{children:["Anyway, once your server is up and running after executing ",(0,o.jsx)(t.code,{children:"go run main.go"})," you can run the benchmark using the following command:"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-bash",children:"oha -n 1000000 -c 100 http://localhost:3000/hello\n"})}),"\n",(0,o.jsxs)(t.p,{children:["The ",(0,o.jsx)(t.code,{children:"-c"})," flag is the number of concurrent connections and the ",(0,o.jsx)(t.code,{children:"-n"})," flag is the number of requests per connection. In my tests, when I was testing Fiber, Express and Pine, I used 1,000,000 requests and 100 concurrent connections. You can change these values to your liking."]}),"\n",(0,o.jsx)(t.p,{children:"You can observe the results and make your own conclusions. Also use this opportunity to test your own solutions and see how they perform."}),"\n",(0,o.jsx)(t.h2,{id:"conclusion",children:"Conclusion"}),"\n",(0,o.jsxs)(t.p,{children:["In my honest opinion, the real rockstars here are authors of the standard ",(0,o.jsx)(t.a,{href:"https://pkg.go.dev/net/http",children:"net/http"})," package and the ",(0,o.jsx)(t.a,{href:"https://github.com/valyala/fasthttp",children:"fasthttp"})," package since that is where most of the performance is gained from."]}),"\n",(0,o.jsx)(t.p,{children:"With the latest release of net/http, it was previously 10 times slower than fasthttp, however, they manage to match or sometimes beat the performance of fasthttp."}),"\n",(0,o.jsx)(t.p,{children:"I am not saying that using frameworks is bad or one framework is better than another, heck, I am not even suggesting that you should use Pine, instead, I am challenging you to be a better developer and try building some of the solutions yourself."}),"\n",(0,o.jsx)(t.p,{children:"I created Pine because I want to learn and teach others about the findings I have learnt and if you have any suggestions or improvements, please do not hesitate to open an issue or a pull request. I want to be a better developer myself and that means learning from my mistakes as well as others. I am in no means perfect, and do not take Pine as my gospel to the world, instead try to learn from it and improve yourself and others."}),"\n",(0,o.jsx)(t.p,{children:"Please be aware that Pine is still very much in beta with improvements coming soon given that as a framework, I have some catching up to do. At this point other frameworks are a couple of years ahead having started some 5 or 6 years ago, but that does not mean I will abandon Pine. I am still learning every day as I implement some of the solutions myself, and I would be happy if anyone would like to contribute to the project."}),"\n",(0,o.jsxs)(t.p,{children:["If you wish to use Pine, please remember the limitations of the project and the fact that it is still in beta. If you like the project, please consider starring it on ",(0,o.jsx)(t.a,{href:"https://github.com/BryanMwangi/pine",children:"GitHub"})," and sharing it with your friends and colleagues."]})]})}function d(e={}){const{wrapper:t}={...(0,a.R)(),...e.components};return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)(c,{...e})}):c(e)}},8453:(e,t,n)=>{n.d(t,{R:()=>i,x:()=>r});var o=n(6540);const a={},s=o.createContext(a);function i(e){const t=o.useContext(s);return o.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function r(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:i(e.components),o.createElement(s.Provider,{value:t},e.children)}}}]);