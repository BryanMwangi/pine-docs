"use strict";(self.webpackChunkpine_docs=self.webpackChunkpine_docs||[]).push([[9324],{9510:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>s,default:()=>h,frontMatter:()=>i,metadata:()=>a,toc:()=>d});var o=t(4848),r=t(8453);const i={sidebar_position:3},s="Cron",a={id:"Guide - Basics/cron",title:"Cron",description:"Pine has a built in cron system that can be used to schedule tasks.",source:"@site/docs/Guide - Basics/cron.md",sourceDirName:"Guide - Basics",slug:"/Guide - Basics/cron",permalink:"/pine-docs/docs/Guide - Basics/cron",draft:!1,unlisted:!1,editUrl:"https://github.com/BryanMwangi/pine-docs/blob/main/docs/Guide - Basics/cron.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{sidebar_position:3},sidebar:"tutorialSidebar",previous:{title:"Ctx",permalink:"/pine-docs/docs/Guide - Basics/ctx"},next:{title:"Client",permalink:"/pine-docs/docs/Guide - Basics/client"}},c={},d=[{value:"Why?",id:"why",level:2},{value:"How to use it?",id:"how-to-use-it",level:2},{value:"Config",id:"config",level:3},{value:"Job",id:"job",level:3},{value:"AddJobs",id:"addjobs",level:3},{value:"Start",id:"start",level:3},{value:"Example",id:"example",level:2}];function l(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"cron",children:"Cron"})}),"\n",(0,o.jsx)(n.p,{children:"Pine has a built in cron system that can be used to schedule tasks."}),"\n",(0,o.jsx)(n.h2,{id:"why",children:"Why?"}),"\n",(0,o.jsx)(n.p,{children:"When I was building Pine, I ran into a problem where I needed to update a database at specific intervals. I am sure you may have ran into a similar problem where you needed to execute a function independently of your server as part of the API you are building."}),"\n",(0,o.jsx)(n.p,{children:"The solution? Cron. I added a cron job system that allows you to define jobs that can be executed at specific intervals. The internal implementation of the cron package, handles scheduling and execution of jobs so you don't have to worry about that."}),"\n",(0,o.jsx)(n.p,{children:"If you find yourself needing more sophisticated methods of implementing cron jobs that Pine doesn't offer, here are some packages that you can use:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"https://github.com/go-co-op/gocron",children:"github.com/go-co-op/gocron"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"https://github.com/robfig/cron",children:"github.com/robfig/cron"})}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["I actually encountered this issue when I was building a project on ",(0,o.jsx)(n.a,{href:"https://fly.io",children:"fly.io"})," and I wanted to schedule a task to run every hour. This ",(0,o.jsx)(n.a,{href:"https://benhoyt.com/writings/flyio/",children:"article"})," also outlines similar challenges when migrating from AWS to fly.io and you needed to have cron jobs for doing something in the background."]}),"\n",(0,o.jsx)(n.h2,{id:"how-to-use-it",children:"How to use it?"}),"\n",(0,o.jsx)(n.p,{children:"You can use the cron package to start a new cron instance and then add jobs to it."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-go",children:"// only the first config is used\n// you can also leave the config empty if you do not want a restart policy\nnewCron := cron.New(...cron.Config)\n// accepts many jobs\nnewCron.AddJobs(...Jobs)\nnewCron.Start()\n"})}),"\n",(0,o.jsx)(n.h3,{id:"config",children:"Config"}),"\n",(0,o.jsxs)(n.p,{children:["The ",(0,o.jsx)(n.code,{children:"Config"})," struct is used to configure the cron instance. You can pass your own configuration to the ",(0,o.jsx)(n.code,{children:"New"})," function."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-go",children:"type Config struct {\n  // When set to true the server will attempt to restart failed jobs\n  RestartOnError bool\n\n  // The number of times a job will be retried before it is deleted\n  // when an error occurs\n  //\n  // Default: 0\n  RetryAttempts int\n\n  // This is the periodic time in which the server can execute\n  // cron jobs. Jobs will be executed as long as the server is running\n  // for example you can use this to make requests to other servers\n  // or update your database\n  //\n  // Default: 5 minutes\n  BackgroundTimeout time.Duration\n}\n"})}),"\n",(0,o.jsx)(n.p,{children:"Default values for the config are as follows:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-go",children:"const (\n  DefaultRetryAttempts  = 0\n  DefaultRestartOnError = false\n  BackgroundTimeout: 5 * time.Minute,\n)\n"})}),"\n",(0,o.jsx)(n.p,{children:"Meaning by default, the server will not restart failed jobs, it will not retry failed jobs and the background timeout is set to 5 minutes."}),"\n",(0,o.jsx)(n.h3,{id:"job",children:"Job"}),"\n",(0,o.jsx)(n.p,{children:"A job is a simple struct that contain the following properties:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-go",children:"type Job struct {\n  id   uuid.UUID\n  Fn   func() error\n  Time time.Duration\n}\n"})}),"\n",(0,o.jsxs)(n.table,{children:[(0,o.jsx)(n.thead,{children:(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.th,{children:"Property"}),(0,o.jsx)(n.th,{children:"Type"}),(0,o.jsx)(n.th,{children:"Description"})]})}),(0,o.jsxs)(n.tbody,{children:[(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:"id"}),(0,o.jsx)(n.td,{children:"uuid.UUID"}),(0,o.jsx)(n.td,{children:"The id of the job. Internal and should not be set manually"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:"Fn"}),(0,o.jsx)(n.td,{children:"func() error"}),(0,o.jsx)(n.td,{children:"The function that will be executed when the job is run"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:"Time"}),(0,o.jsx)(n.td,{children:"time.Duration"}),(0,o.jsx)(n.td,{children:"The time interval at which the job will be executed"})]})]})]}),"\n",(0,o.jsx)(n.h3,{id:"addjobs",children:"AddJobs"}),"\n",(0,o.jsx)(n.p,{children:"This method accepts as many jobs as you want and adds them to the cron instance."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-go",children:"func (c *Cron) AddJobs(jobs ...Job)\n"})}),"\n",(0,o.jsx)(n.h3,{id:"start",children:"Start"}),"\n",(0,o.jsx)(n.p,{children:"Starts the cron instance. This method will run the cron jobs until the server is shut down."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-go",children:"func (c *Cron) Start()\n"})}),"\n",(0,o.jsx)(n.h2,{id:"example",children:"Example"}),"\n",(0,o.jsx)(n.p,{children:"Here is an example of how you can use the cron package to schedule simple tasks."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-go",children:'package main\n\nimport (\n    "log"\n    "time"\n\n    "github.com/BryanMwangi/pine"\n    "github.com/BryanMwangi/pine/cron"\n)\n\nfunc main() {\n\t// Initialize a new Pine app\n\tapp := pine.New()\n\n\ttask := cron.Job{\n\t\tFn:   logHello,\n\t\tTime: 6 * time.Second,\n\t}\n\ttask2 := cron.Job{\n\t\tFn:   logError,\n\t\tTime: 1 * time.Second,\n\t}\n\ttask3 := cron.Job{\n\t\tFn:   logHello2,\n\t\tTime: 3 * time.Second,\n\t}\n\n\tnewCron := cron.New(cron.Config{\n\t\tRestartOnError: true,\n\t\tRetryAttempts:  3,\n\t})\n\n\t// There is no limit to the number of jobs you can add to the queue\n\t// However the queue size will impact the performance so be mindful and demure\n\t//\n\t// Also note that each task is executed in its own goroutine and performance\n\t// is relatively determined by the number of physical cores on your machine\n\tnewCron.AddJobs(task, task2, task3)\n\tnewCron.Start()\n\n\t// Define a route for the GET method on the root path \'/hello\'\n\tapp.Get("/hello", func(c *pine.Ctx) error {\n\t\treturn c.SendString("Hello World!")\n\t})\n\n\t// Start the server on port 3000\n\tlog.Fatal(app.Start(":3000", "", ""))\n}\n\nfunc logHello() error {\n\tfmt.Println("Hello World!")\n\treturn nil\n}\n\n// errors are handled internally depending on the restart policy of the cron\n// If no restart policy is set, the error will cause the job to be removed\n// immediately from the queue\nfunc logError() error {\n\treturn fmt.Errorf("Error")\n}\n\nfunc logHello2() error {\n\tfmt.Println("Another Hello World!")\n\treturn nil\n}\n'})}),"\n",(0,o.jsxs)(n.p,{children:["A much deeper breakdown can be found in the ",(0,o.jsx)(n.a,{href:"/docs/category/guide---advanced",children:"Advanced Guide"}),"."]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(l,{...e})}):l(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>s,x:()=>a});var o=t(6540);const r={},i=o.createContext(r);function s(e){const n=o.useContext(i);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:s(e.components),o.createElement(i.Provider,{value:n},e.children)}}}]);